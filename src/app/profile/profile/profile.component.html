<app-navbar></app-navbar>

<div class="container-fluid mt-4">
    <p-card *ngIf="(profile$ | async) as profile"  #myDiv>
        <div class="d-flex flex-row"> 
            <p-avatar 
            shape="circle" styleClass="profile"
            [icon]="profile.profilePhotoUrl? '' : 'pi pi-user'" 
            [image]="profile.profilePhotoUrl? profile.profilePhotoUrl : ''"
            (click)="show()"
            pTooltip="Edit your profile photo"></p-avatar>
            <div class="p-ml-3 w-100">
                <div class="d-flex justify-content-between align-items-center p-pt-3">
                    <div class="d-flex flex-row align-items-center"> 
                        <span class="name">
                            <h4>{{ profile.displayName }}</h4> 
                        </span>  
                    </div> 
                </div>
                <small style="font-size: smaller;" *ngIf="(presenceService.onlineUsers$ | async).includes(profile.id)">Active now</small>
                <small style="font-size: smaller;" *ngIf="!(presenceService.onlineUsers$ | async).includes(profile.id)">Active {{ profile.lastActive |  timeago }}</small>
            </div>
            <p-button
            *ngIf="(user$ | async)?.id !== userId"
            [icon]="(profile$ | async).isFollowing? 'pi pi-check' : 'pi pi-plus'" 
            [label]="(profile$ | async).isFollowing? 'following' :'follow'"
            (click)="followToggle()"
            styleClass="p-button-rounded p-button-warning p-button-text"></p-button>
            <i class="pi pi-ellipsis-v"
            *ngIf="(user$ | async)?.id === userId"
            #followButton
            (click)="menu.toggle($event)">
            </i>
        </div>
    </p-card>
    <p-card>
        <p-tabView [scrollable]="true" [(activeIndex)]="index" (onChange)="indexChanged(index)">
            <p-tabPanel header="About">
                <ng-template pTemplate="content">
                    <app-user-about></app-user-about>
                </ng-template>
            </p-tabPanel>
            <p-tabPanel header="Photos">
                <ng-template pTemplate="content">
                    <p-scrollPanel [style]="{height: '200px'}">
                        <app-galleria [photos]="(photos$ | async)"></app-galleria>
                    </p-scrollPanel>
                </ng-template>
            </p-tabPanel>
            <p-tabPanel header="Followings">
                <ng-template pTemplate="content">
                    <p-scrollPanel [style]="{height: '200px'}">
                        <div class="row">
                            <div class="col-12 col-md-6 pt-1" *ngFor="let user of (followings$ | async)">
                                <app-user-card [user]="user"></app-user-card>
                            </div>
                        </div>
                    </p-scrollPanel>
                    <div *ngIf="(followings$ | async)?.length === 0">
                        Nothing to show.
                    </div>
                </ng-template>
            </p-tabPanel>
            <p-tabPanel header="Followers">
                <ng-template pTemplate="content">
                    <div *ngIf="(followers$ | async)?.length === 0">
                        Nothing to show.
                    </div>
                    <p-scrollPanel [style]="{height: '200px'}">
                        <div class="row">
                            <div class="col-12 col-md-6 pt-1" *ngFor="let user of (followers$ | async)">
                                <app-user-card [user]="user"></app-user-card>
                            </div>
                        </div>
                    </p-scrollPanel>
                </ng-template>
            </p-tabPanel>
            <p-tabPanel header="Activities">
                <ng-template pTemplate="content">
                    <p-scrollPanel [style]="{height: '200px'}" *ngIf="(user$ | async)?.id === userId">
                        
                    </p-scrollPanel>
                </ng-template>
            </p-tabPanel>
            <p-tabPanel header="Messaging" *ngIf="(user$ | async)?.id !== userId" controlClose="true" (onClose)="stopHub($event)">
                <ng-template pTemplate="content">
                    <app-thread [contactId]="userId"></app-thread>
                </ng-template>
            </p-tabPanel>
        </p-tabView>
    </p-card>
</div>

<div class="container-fluid" *ngIf="(user$ | async)?.id === userId">
        <div class="row d-flex justify-content-center">
            <div class="col-12 col-sm-12 col-md-6 pt-1">
                <p-card>
                    <app-add-post></app-add-post>
                </p-card>
            </div>
        </div>
</div>

<div *ngFor="let post of (profile$|async)?.posts">
    <div class="d-flex justify-content-center">
        <div class="col-12 col-md-6">
            <app-post-card [post]="post"></app-post-card>
        </div>
    </div>
</div>

<div class="d-flex justify-content-center mt-4" *ngIf="(profile$|async)?.posts.length === 0">
    <div class="col-12 col-sm-6 col-md-6">
        <p-card styleClass="no-post">
            <h3 style="text-align: center;">No posts yet.</h3>
        </p-card>
    </div>
</div>

<div class="d-flex justify-content-center mt-3">
    <div class="col-12 col-sm-6 col-md-6">
        <p-card styleClass="joined">
            <h3 style="text-align: center;">Joined in 19/02/1999 </h3>
        </p-card>
    </div>
</div>

<p-menu #menu [popup]="true" [model]="items"></p-menu>

<p-dialog header="Add profile picture" [(visible)]="displayDialog" [breakpoints]="{'960px': '75vw'}" [style]="{width: '50vw'}"
    [dismissableMask]="true" [resizable]="false">
        
    <app-add-profile-photo (hideDialogEmitter)="displayDialog=false" (photoUploadedEmitter)="photoUploaded($event)"></app-add-profile-photo>

</p-dialog>